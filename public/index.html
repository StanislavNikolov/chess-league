<!DOCTYPE html>
<html>
  <head>
    <style>
body {
  margin: 0;
}
main {
  width: 100vw;
  height: 100vh;
  margin: 0;
  padding: 20px;
  box-sizing: border-box;

  background: radial-gradient(circle at 50% 0%, rgba(247,232,211,1) 0%, rgba(218,190,164,1) 71%, rgba(154,130,118,1) 100%);

  display: grid;
  grid-template-columns: 1fr 1fr 1fr 1fr;
  grid-template-rows: minmax(auto, 200px) 1fr 1fr 1fr;
  grid-gap: 20px;
  grid-template-areas: 
    "head head head head"
    "hlead live live old"
    "blead live live old"
    "blead live live upl";
}
#head-tile { grid-area: head; }
#human-leaderboard-tile { grid-area: hlead; }
#bot-leaderboard-tile { grid-area: blead; }
#old-games-tile { grid-area: old; }
#live-games-tile { grid-area: live; }
#upload-tile { grid-area: upl; }

.tile {
  display: inline-block;
  font-family: Verdana;
  background-color: rgba(255,255,255,1);
  padding: 8px;
  border-radius: 8px;
  color: #7a4e3c;
  box-shadow: rgba(0, 0, 0, 0.24) 0px 3px 8px;
}

h2 {
  text-align: center;
  color: #694638;
}

.crown {
  display: inline-block;
  background: url(/public/crown.svg);
  background-size: contain;
  height: 1rem;
  width: 1rem;
}
.crown.w { transform: translate(11px, -3px) rotate(-45deg); }
.crown.b { transform: translate(-11px, -3px) rotate(45deg); }


#head-tile {
  background: url(/public/head5_q90.jpg);
  background-repeat: no-repeat;
  background-size: cover;
  background-position: center;
}

.game {
  display: flex;
  justify-content: center;
}
.bot {
  display: inline-block;
  width: 50%;
  margin: 0px 7px;
}
.bot.white {
  text-align: right;
}
    </style>
  </head>

  <body>
    <main>
      <div id="head-tile" class="tile">
      </div>
      <div id="human-leaderboard-tile" class="tile">
        <h2>Human Leaderboard</h2>
        <div id="human-list"></div>
      </div>
      <div id="bot-leaderboard-tile" class="tile">
        <h2>Bot Leaderboard</h2>
        <div id="bot-list"></div>
      </div>
      <div id="live-games-tile" class="tile">
        <h2>Live Games</h2>
      </div>
      <div id="old-games-tile" class="tile">
        <h2>Old Games</h2>
        <div id="old-games"></div>
      </div>
      <div id="upload-tile" class="tile">
        <h2>Upload Your Bot</h2>
      </div>
    </main>

    <script>
      const $ = s => document.querySelector(s);

      function sanitizeHTML(text) {
        const element = document.createElement('div');
        element.innerText = text;
        return element.innerHTML;
      }

      function renderLeaderboardItem(place, bot) {
        console.log(bot);
        const age = (Math.random() * 10).toFixed(0) + ' days';
        return `
          <div class="leaderboard-item">
            <span class="place">${place}</span>
            <span class="bot">${sanitizeHTML(bot.name)}</span>
            <span class="age">${age}</span>
          </div>
        `;

      }

      fetch('/api/bots/')
      .then(req => req.json())
      .then(bots => {
        let html = '';
        for(let i = 0;i < bots.length;i ++) {
          html += renderLeaderboardItem(i+1, bots[i]);
        }
        $('#bot-list').innerHTML = html;
      })

      function renderGame(g) {
        console.log(g);
        return `
          <div class="game">
            <span class="bot white">
              ${g.winner === 'w' ? '<span class="crown w"></span>' : ''}
              ${sanitizeHTML(g.wname)}
            </span>
            <span class="bot black">
              ${sanitizeHTML(g.wname)}
              ${g.winner === 'b' ? '<span class="crown b"></span>' : ''}
            </span>
          </div>
        `;
      }

      fetch('/api/games/')
      .then(req => req.json())
      .then(games => {
        let html = '';
        for(const g of games) {
          html += renderGame(g);
        }
        $('#old-games').innerHTML = html;
      })
    </script>
  </body>
</html>

